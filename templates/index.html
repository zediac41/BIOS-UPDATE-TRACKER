<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIOS Updates</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold mb-4">Motherboard BIOS Updates</h1>

        <!-- Search and Sort -->
        <div class="mb-4 flex flex-col md:flex-row gap-4">
            <input type="text" id="search" placeholder="Search by motherboard or vendor"
                   class="p-2 border rounded w-full md:w-1/3">
            <select id="sort" class="p-2 border rounded">
                <option value="release_date">Sort by Date</option>
                <option value="motherboard">Sort by Motherboard</option>
                <option value="vendor">Sort by Vendor</option>
            </select>
            <select id="order" class="p-2 border rounded">
                <option value="desc">Descending</option>
                <option value="asc">Ascending</option>
            </select>
            <button onclick="applyFilters()" class="bg-blue-500 text-white p-2 rounded hover:bg-blue-600">
                Apply
            </button>
        </div>

        <!-- BIOS Updates Table -->
        <table id="bios-table" class="w-full border-collapse bg-white shadow-md">
            <thead>
                <tr class="bg-gray-200">
                    <th class="p-2 border">Motherboard</th>
                    <th class="p-2 border">Vendor</th>
                    <th class="p-2 border">Version</th>
                    <th class="p-2 border">Release Date</th>
                    <th class="p-2 border">Download</th>
                </tr>
            </thead>
            <tbody id="table-body"></tbody>
        </table>
    </div>

    <script>
        async function fetchBiosData() {
            const repo = "https://zediac41.github.io/BIOS-UPDATE-TRACKER/"; // Replace with your repo
            const url = `https://raw.githubusercontent.com/${repo}/main/bios_data.json`;
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('Failed to fetch BIOS data');
                return await response.json();
            } catch (error) {
                console.error('Error:', error);
                return [];
            }
        }

        function renderTable(data, search = '', sortBy = 'release_date', order = 'desc') {
            const tableBody = document.getElementById('table-body');
            tableBody.innerHTML = '';

            // Filter data
            let filteredData = data.filter(entry =>
                entry.motherboard.toLowerCase().includes(search.toLowerCase()) ||
                entry.vendor.toLowerCase().includes(search.toLowerCase())
            );

            // Flatten versions for sorting
            let rows = [];
            filteredData.forEach(entry => {
                entry.versions.forEach((version, index) => {
                    rows.push({
                        motherboard: entry.motherboard,
                        vendor: entry.vendor,
                        version: version.version,
                        release_date: version.release_date,
                        download_link: version.download_link,
                        is_latest: index === 0
                    });
                });
            });

            // Sort data
            rows.sort((a, b) => {
                let valA = a[sortBy], valB = b[sortBy];
                if (sortBy === 'release_date') {
                    valA = new Date(valA);
                    valB = new Date(valB);
                }
                if (order === 'asc') {
                    return valA > valB ? 1 : -1;
                } else {
                    return valA < valB ? 1 : -1;
                }
            });

            // Group by motherboard for display
            const grouped = {};
            rows.forEach(row => {
                if (!grouped[row.motherboard]) {
                    grouped[row.motherboard] = {
                        vendor: row.vendor,
                        versions: []
                    };
                }
                grouped[row.motherboard].versions.push(row);
            });

            // Render table
            Object.keys(grouped).forEach(motherboard => {
                const versions = grouped[motherboard].versions;
                versions.forEach((row, index) => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        ${index === 0 ? `<td class="p-2 border" rowspan="${versions.length}">${row.motherboard}</td>` : ''}
                        ${index === 0 ? `<td class="p-2 border" rowspan="${versions.length}">${row.vendor}</td>` : ''}
                        <td class="p-2 border">${row.version}</td>
                        <td class="p-2 border">${row.release_date}</td>
                        <td class="p-2 border">
                            ${row.is_latest && row.download_link ? `<a href="${row.download_link}" class="text-blue-500 hover:underline" target="_blank">Download</a>` : ''}
                        </td>
                    `;
                    tableBody.appendChild(tr);
                });
            });
        }

        async function applyFilters() {
            const search = document.getElementById('search').value;
            const sort = document.getElementById('sort').value;
            const order = document.getElementById('order').value;
            const data = await fetchBiosData();
            renderTable(data, search, sort, order);
        }

        // Initial load
        applyFilters();
    </script>
</body>
</html>
